<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>è´ªåƒè›‡ - å¼¹çª—ç¡®è®¤ç‰ˆ</title>
<style>
body {
  margin: 0;
  background: #222;
  color: #fff;
  display: flex;
  flex-direction: column;
  align-items: center;
  font-family: Arial, sans-serif;
  user-select: none;
}
canvas {
  border: 2px solid #fff;
  margin-top: 20px;
  touch-action: none;
}
.controls {
  margin-top: 10px;
}
button {
  width: 60px;
  height: 40px;
  margin: 5px;
  font-size: 16px;
}
</style>
</head>
<body>
<h2>è´ªåƒè›‡ ğŸ</h2>
<canvas id="gameCanvas" width="300" height="300"></canvas>
<div class="controls">
  <button onclick="setDir('UP')">â¬†</button><br>
  <button onclick="setDir('LEFT')">â¬…</button>
  <button onclick="setDir('DOWN')">â¬‡</button>
  <button onclick="setDir('RIGHT')">â¡</button>
  <button onclick="restartGame()">é‡æ–°å¼€å§‹</button>
</div>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
const box = 15;
const cols = canvas.width / box;
const rows = canvas.height / box;

let snake, direction, nextDirection, food, score;
let moveInterval = 200; // è›‡ç§»åŠ¨é€Ÿåº¦(ms)
let lastMoveTime = 0;

// åˆå§‹åŒ–æ¸¸æˆ
function initGame() {
  snake = [{x:5, y:5}];
  direction = "RIGHT";
  nextDirection = "RIGHT";
  score = 0;
  generateFood();
}

// ç”Ÿæˆé£Ÿç‰©ï¼ˆä¸ä¼šå‡ºç°åœ¨è›‡èº«ä¸Šï¼‰
function generateFood() {
  let newFood;
  do {
    newFood = {
      x: Math.floor(Math.random()*cols),
      y: Math.floor(Math.random()*rows)
    };
  } while (snake.some(seg => seg.x===newFood.x && seg.y===newFood.y));
  food = newFood;
}

initGame();

// æŒ‰é”®æ§åˆ¶ï¼ˆæ–¹å‘ç¼“å†²ï¼‰
document.addEventListener("keydown", e=>{
  switch(e.key){
    case "ArrowLeft": if(direction!=="RIGHT") nextDirection="LEFT"; break;
    case "ArrowUp": if(direction!=="DOWN") nextDirection="UP"; break;
    case "ArrowRight": if(direction!=="LEFT") nextDirection="RIGHT"; break;
    case "ArrowDown": if(direction!=="UP") nextDirection="DOWN"; break;
  }
});

// æŒ‰é’®æ§åˆ¶
function setDir(dir){
  if(dir==="LEFT" && direction!=="RIGHT") nextDirection="LEFT";
  else if(dir==="UP" && direction!=="DOWN") nextDirection="UP";
  else if(dir==="RIGHT" && direction!=="LEFT") nextDirection="RIGHT";
  else if(dir==="DOWN" && direction!=="UP") nextDirection="DOWN";
}

// æ‰‹æœºæ»‘åŠ¨æ§åˆ¶
let touchStartX=0, touchStartY=0;
canvas.addEventListener("touchstart", e=>{
  const t = e.touches[0];
  touchStartX = t.clientX;
  touchStartY = t.clientY;
});
canvas.addEventListener("touchmove", e=>{
  e.preventDefault();
  const t = e.touches[0];
  const dx = t.clientX - touchStartX;
  const dy = t.clientY - touchStartY;
  if(Math.abs(dx)>Math.abs(dy)){
    if(dx>0) setDir("RIGHT"); else setDir("LEFT");
  } else {
    if(dy>0) setDir("DOWN"); else setDir("UP");
  }
  touchStartX = t.clientX;
  touchStartY = t.clientY;
}, {passive:false});

// é‡æ–°å¼€å§‹æŒ‰é’®
function restartGame(){
  if(confirm("æ˜¯å¦é‡æ–°å¼€å§‹æ¸¸æˆï¼Ÿ")){
    initGame();
  }
}

// æ›´æ–°è›‡ä½ç½®
function updateSnake(){
  direction = nextDirection;
  let headX = snake[0].x;
  let headY = snake[0].y;

  switch(direction){
    case "LEFT": headX--; break;
    case "UP": headY--; break;
    case "RIGHT": headX++; break;
    case "DOWN": headY++; break;
  }

  const newHead = {x:headX, y:headY};

  // æ’å¢™æˆ–æ’è‡ªå·± â†’ å¼¹çª—æç¤ºåˆ†æ•° + æ˜¯å¦é‡æ–°å¼€å§‹
  if(headX<0 || headY<0 || headX>=cols || headY>=rows ||
     snake.some(seg=>seg.x===newHead.x && seg.y===newHead.y)){
    alert("æ¸¸æˆç»“æŸï¼å¾—åˆ†: "+score);
    if(confirm("æ˜¯å¦é‡æ–°å¼€å§‹æ¸¸æˆï¼Ÿ")){
      initGame();
    }
    return;
  }

  snake.unshift(newHead);

  // åƒåˆ°é£Ÿç‰©
  if(headX===food.x && headY===food.y){
    score++;
    generateFood();
  } else {
    snake.pop();
  }
}

// ç»˜åˆ¶æ¸¸æˆ
function draw(){
  ctx.fillStyle="#000";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  // ç”»è›‡
  for(let i=0;i<snake.length;i++){
    ctx.fillStyle=i===0?"lime":"green";
    ctx.fillRect(snake[i].x*box, snake[i].y*box, box, box);
  }

  // ç”»é£Ÿç‰©
  ctx.fillStyle="red";
  ctx.fillRect(food.x*box, food.y*box, box, box);

  // åˆ†æ•°
  ctx.fillStyle="#fff";
  ctx.font="16px Arial";
  ctx.fillText("åˆ†æ•°: "+score,10,canvas.height-10);
}

// æ¸¸æˆå¾ªç¯
function gameLoop(timestamp){
  if(!lastMoveTime) lastMoveTime=timestamp;
  if(timestamp - lastMoveTime > moveInterval){
    updateSnake();
    lastMoveTime=timestamp;
  }
  draw();
  requestAnimationFrame(gameLoop);
}

requestAnimationFrame(gameLoop);
</script>
</body>
</html>