<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>è´ªåƒè›‡ - é€€å‡ºç½‘é¡µç¡®è®¤ç‰ˆ</title>
<style>
body { margin:0; background:#222; color:#fff; display:flex; flex-direction:column; align-items:center; font-family:Arial, sans-serif; user-select:none;}
canvas { border:2px solid #fff; margin-top:20px; touch-action:none;}
.controls { margin-top:10px;}
button { width:100px; height:40px; margin:5px; font-size:16px;}
</style>
</head>
<body>
<h2>è´ªåƒè›‡ ğŸ</h2>
<canvas id="gameCanvas" width="300" height="300"></canvas>
<div class="controls">
  <button onclick="setDir('UP')">â¬†</button><br>
  <button onclick="setDir('LEFT')">â¬…</button>
  <button onclick="setDir('DOWN')">â¬‡</button>
  <button onclick="setDir('RIGHT')">â¡</button>
  <button onclick="restartGame()">é‡æ–°å¼€å§‹</button>
  <button onclick="exitGame()">é€€å‡ºæ¸¸æˆ</button>
</div>

<script>
const canvas=document.getElementById("gameCanvas");
const ctx=canvas.getContext("2d");
const box=15, cols=canvas.width/box, rows=canvas.height/box;
let snake,direction,nextDirection,food,score;
let moveInterval=200,lastMoveTime=0,gameOver=false;

// åˆå§‹åŒ–æ¸¸æˆ
function initGame(){
  snake=[{x:5,y:5}];
  direction="RIGHT"; nextDirection="RIGHT";
  score=0; gameOver=false;
  generateFood();
}

// ç”Ÿæˆé£Ÿç‰©
function generateFood(){
  let newFood;
  do{
    newFood={x:Math.floor(Math.random()*cols), y:Math.floor(Math.random()*rows)};
  }while(snake.some(seg=>seg.x===newFood.x && seg.y===newFood.y));
  food=newFood;
}
initGame();

// é”®ç›˜æ§åˆ¶
document.addEventListener("keydown",e=>{
  if(gameOver) return;
  if(e.key==="ArrowLeft" && direction!=="RIGHT") nextDirection="LEFT";
  else if(e.key==="ArrowUp" && direction!=="DOWN") nextDirection="UP";
  else if(e.key==="ArrowRight" && direction!=="LEFT") nextDirection="RIGHT";
  else if(e.key==="ArrowDown" && direction!=="UP") nextDirection="DOWN";
});

// æŒ‰é’®æ§åˆ¶
function setDir(dir){ if(gameOver) return;
  if(dir==="LEFT" && direction!=="RIGHT") nextDirection="LEFT";
  else if(dir==="UP" && direction!=="DOWN") nextDirection="UP";
  else if(dir==="RIGHT" && direction!=="LEFT") nextDirection="RIGHT";
  else if(dir==="DOWN" && direction!=="UP") nextDirection="DOWN";
}

// æ‰‹åŠ¿æ§åˆ¶
let touchStartX=0,touchStartY=0;
canvas.addEventListener("touchstart",e=>{ const t=e.touches[0]; touchStartX=t.clientX; touchStartY=t.clientY; });
canvas.addEventListener("touchmove",e=>{
  e.preventDefault(); if(gameOver) return;
  const t=e.touches[0]; const dx=t.clientX-touchStartX, dy=t.clientY-touchStartY;
  if(Math.abs(dx)>Math.abs(dy)){ if(dx>0 && direction!=="LEFT") nextDirection="RIGHT"; else if(dx<0 && direction!=="RIGHT") nextDirection="LEFT"; }
  else{ if(dy>0 && direction!=="UP") nextDirection="DOWN"; else if(dy<0 && direction!=="DOWN") nextDirection="UP"; }
  touchStartX=t.clientX; touchStartY=t.clientY;
},{passive:false});

// é‡æ–°å¼€å§‹
function restartGame(){ if(confirm("æ˜¯å¦é‡æ–°å¼€å§‹æ¸¸æˆï¼Ÿ")) initGame(); }

// é€€å‡ºæ¸¸æˆæŒ‰é’®ï¼ˆç¡®è®¤é€€å‡ºç½‘é¡µï¼‰
function exitGame(){
  if(confirm("æ˜¯å¦ç¡®è®¤é€€å‡ºç½‘é¡µï¼Ÿ")){
    gameOver=true;
    // å°è¯•å…³é—­ç½‘é¡µ
    window.open('', '_self'); 
    window.close(); 
    // å¦‚æœæµè§ˆå™¨é™åˆ¶å…³é—­ï¼Œæç¤ºç”¨æˆ·æ‰‹åŠ¨å…³é—­
    setTimeout(()=>{ alert("å¦‚æœé¡µé¢æœªå…³é—­ï¼Œè¯·æ‰‹åŠ¨è¿”å›æˆ–å…³é—­æµè§ˆå™¨æ ‡ç­¾é¡µ"); }, 100);
  }
}

// æ›´æ–°è›‡
function updateSnake(){
  if(gameOver) return;
  direction=nextDirection;
  let headX=snake[0].x, headY=snake[0].y;
  switch(direction){ case "LEFT": headX--; break; case "UP": headY--; break; case "RIGHT": headX++; break; case "DOWN": headY++; break; }
  const newHead={x:headX,y:headY};

  if(headX<0||headY<0||headX>=cols||headY>=rows||snake.some(seg=>seg.x===newHead.x&&seg.y===newHead.y)){
    alert("æ¸¸æˆç»“æŸï¼å¾—åˆ†:"+score);
    gameOver=true;
    if(confirm("æ˜¯å¦é‡æ–°å¼€å§‹ï¼Ÿ")) initGame();
    return;
  }

  snake.unshift(newHead);
  if(headX===food.x&&headY===food.y) score++,generateFood();
  else snake.pop();
}

// ç»˜åˆ¶æ¸¸æˆ
function draw(){
  ctx.fillStyle="#000"; ctx.fillRect(0,0,canvas.width,canvas.height);
  for(let i=0;i<snake.length;i++){ ctx.fillStyle=i===0?"lime":"green"; ctx.fillRect(snake[i].x*box,snake[i].y*box,box,box);}
  ctx.fillStyle="red"; ctx.fillRect(food.x*box,food.y*box,box,box);
  ctx.fillStyle="#fff"; ctx.font="16px Arial"; ctx.fillText("åˆ†æ•°:"+score,10,canvas.height-10);
}

// æ¸¸æˆå¾ªç¯
function gameLoop(ts){
  if(!lastMoveTime) lastMoveTime=ts;
  if(ts-lastMoveTime>moveInterval){ updateSnake(); lastMoveTime=ts; }
  draw(); requestAnimationFrame(gameLoop);
}

requestAnimationFrame(gameLoop);
</script>
</body>
</html>
